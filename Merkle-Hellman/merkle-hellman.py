import numpy as np
import whale

def encrypt_text(text, pub_key, encoding):
    # Encode the text
    encoded_text = ''.join(list(map(lambda x: encoding[x], text)))

    # Insert more zeroes at the end in case that the length of the
    # string is not a multiple of the length of the public key
    if not len(encoded_text) % len(pub_key) == 0:
        n_zeroes = len(pub_key) - len(encoded_text) % len(pub_key)
        encoded_text += '0' * n_zeroes

    # Split encoded text in chunks of the same size as the public key
    split_text = [encoded_text[i:i+len(pub_key)] for i in range(0, len(encoded_text), len(pub_key))]

    # For each chunk, set all positions in which a '1' is found to True
    # and to False if a '0' is found
    occurrences = [[True if bit == '1' else False for bit in chunk] for chunk in split_text]

    # Cipher the encoded chunks by adding keys which have the same index
    # as
    cipher = [np.sum(pub_key, where=o, initial=0) for o in occurrences]

    return cipher


if __name__ == '__main__':
    # Public key
    pub_key = [3060194823332251282799283788839547121154100513873178805755197,
               2906513558146522014514643392996769037263795020905152654316267,
               2599151027775063477945362601311212869483184034969100351438407,
               1984425967032146404806801017940100533921962063096995745682687,
               754975845546312258529677851197875862799518119352786534171247,
               1509951691092624517059355702395751725599036238705573068342494,
               3019903382185249034118711404791503451198072477411146136684988,
               2825930675852517517153498624900681697351738947981087316175849,
               2437985263187054483223073065119038189659071889120969675157571,
               1662094437856128415362221945555751174273737771400734393121015,
               110312787194276279640519706429177143503069535960263829047903,
               220625574388552559281039412858354287006139071920527658095806,
               441251148777105118562078825716708574012278143841055316191612,
               882502297554210237124157651433417148024556287682110632383224,
               1765004595108420474248315302866834296049112575364221264766448,
               316133101698860397412706421051343387053819143887237572338769,
               632266203397720794825412842102686774107638287774475144677538,
               1264532406795441589650825684205373548215276575548950289355076,
               2529064813590883179301651368410747096430553151097900578710152,
               1844253538663785807519378552139168987816700295354596200226177,
               474630988809591063954832919596012770588994583867987443258227,
               949261977619182127909665839192025541177989167735974886516454,
               1898523955238364255819331678384051082355978335471949773032908,
               583171821958747960554739172085776959667550664102694588871689,
               1166343643917495921109478344171553919335101328205389177743378,
               2332687287834991842218956688343107838670202656410778355486756,
               1451498487152003133353989192003890472295999305980351753779385,
               2902996974304006266707978384007780944591998611960703507558770,
               2592117860090031982332032583333236684139591217080202057923413,
               1970359631662083413580140981984148163234776427319199158652699,
               726843174806186276076357779285971121425146847797193360111271,
               1453686349612372552152715558571942242850293695594386720222542,
               2907372699224745104305431117143884485700587391188773440445084,
               2600869309931509657526938049605443766356768775536341923696041,
               1987862531345038763969951914528562327669131544231478890197955,
               761848974172096976855979644374799450293857081621752823201783,
               1523697948344193953711959288749598900587714163243505646403566,
               3047395896688387907423918577499197801175428326487011292807132,
               2880915704858795263763912970316070397306450646132817628420137,
               2547955321199609976443901755949815589568495285424430299646147,
               1882034553881239401803879327217305974092584564007655642098167,
               550193019244498252523834469752286743140763121174106327002207,
               1100386038488996505047668939504573486281526242348212654004414,
               2200772076977993010095337879009146972563052484696425308008828,
               1187668065438005469106751573335968740081698962551645658823529,
               2375336130876010938213503146671937480163397925103291317647058,
               1536796173234041325343082108661549755282389843365377678099989,
               3073592346468082650686164217323099510564779686730755356199978,
               2933308604418184750288404249963873816085153366620305755205829,
               2652741120318388949492884315245422427125900726399406553217531,
               2091606152118797347901844445808519649207395445957608149240935,
               969336215719614144719764706934714093370384885074011341287743,
               1938672431439228289439529413869428186740769770148022682575486,
               663468774360476027795134643056531168437133533454840407956845,
               1326937548720952055590269286113062336874267066909680815913690,
               2653875097441904111180538572226124673748534133819361631827380,
               2093874106365827671277152959769924142452662260797518306460633,
               973872124213674791470381734857523079860918514753831655727139,
               1947744248427349582940763469715046159721837029507663311454278,
               681612408336718614797602754747767114399268052174121665714429,
               1363224816673437229595205509495534228798536104348243331428858,
               2726449633346874459190411018991068457597072208696486662857716,
               2239023178175768367296897853299811710149738410551768368521305,
               1264170267833556183509871521917298215255070814262331779848483,
               2528340535667112367019743043834596430510141628524663559696966,
               1842804982816244182955561902986867655975877250208122162199805,
               471733877114507814827199621291410106907348493575039367205483,
               943467754229015629654399242582820213814696987150078734410966,
               1886935508458031259308798485165640427629393974300157468821932,
               559994928398081967533672785648955650214381941759109980449737,
               1119989856796163935067345571297911300428763883518219960899474,
               2239979713592327870134691142595822600857527767036439921798948,
               1266083338666675189185458100509319996670649527231674886403769,
               2532166677333350378370916201018639993341299054463349772807538,
               1850457266148720205657908217354954781638192102085494588420949,
               487038443779459860231892250027584358231978197329784219647771,
               974076887558919720463784500055168716463956394659568439295542,
               1948153775117839440927569000110337432927912789319136878591084,
               682431461717698330771213815538349660811419571797068799988041,
               1364862923435396661542427631076699321622839143594137599976082,
               2729725846870793323084855262153398643245678287188275199952164,
               2245575605223606095085786339624472081446950567535345442710201,
               1277275121929231639087648494566618957849495128229485928226275,
               2554550243858463278175296989133237915698990256458971856452550,
               1895224399198946005266669793584150626353574506076738755710973,
               576572709879911459449415402485976047662743005312272554227819,
               1153145419759822918898830804971952095325486010624545108455638,
               2306290839519645837797661609943904190650972021249090216911276,
               1398705590521311124511399035205483176257538035656975476628425,
               2797411181042622249022798070410966352515076071313950953256850,
               2380946273567263946961671956139607499985746135786696949319573,
               1548016458616547342839419727596889794927086264732188941445019,
               3096032917233094685678839455193779589854172529464377882890038,
               2978189745948208820273754725705233974663939052087550808585949,
               2742503403378437089463585266728142744283472097333896659977771,
               2271130718238893627843246348773960283522538187826588362761415,
               1328385347959806704602568512865595362000670368811971768328703,
               2656770695919613409205137025731190724001340737623943536657406,
               2099665303321246267326349866780056242958275468406682116120685,
               985454518124511983568775548877787280872144929972159275047243,
               1970909036249023967137551097755574561744289859944318550094486,
               727941983980067383191178010828823918444173713047432142994845,
               1455883967960134766382356021657647836888347426094864285989690,
               2911767935920269532764712043315295673776694852189728571979380,
               2609659783322558514445499901948266142508983697538252186764633,
               2005443478127136477807075619214207079973561388235299416335139,
               797010867736292404530227053746088954902716769629393875476151,
               1594021735472584809060454107492177909805433539258787750952302,
               3188043470945169618120908214984355819610867078517575501904604,
               3162210853372358685157892245286386434177328150193946046615081,
               3110545618226736819231860305890447663310250293546687136036035,
               3007215147935493087379796427098570121576094580252169314877943,
               2800554207353005623675668669514815038107783153663133672561759,
               2387232326188030696267413154347304871171160300485062387929391,
               1560588563858080841450902124012284537297914594128919818664655,
               3121177127716161682901804248024569074595829188257839637329310,
               3028478166914342814719684311366812944147252369674474317464493,
               2843080245310705078355444438051300683250098732507743677734859,
               2472284402103429605626964691420276161455791458174282398275591,
               1730692715688878660170005198158227117867176909507359839357055,
               247509342859776769256086211634129030689947812173514721519983,
               495018685719553538512172423268258061379895624347029443039966,
               990037371439107077024344846536516122759791248694058886079932,
               1980074742878214154048689693073032245519582497388117772159864,
               746273397238447757013455201463739285994758987935030587125601,
               1492546794476895514026910402927478571989517975870061174251202,
               2985093588953791028053820805854957143979035951740122348502404,
               2756311089389601505023717427027589082913665896639039739810681,
               2298746090261222458963510669372852960782925786436874522427235,
               1383616092004464366843097154063380716521445566032544087660343,
               2767232184008928733686194308126761433042891132065088175320686,
               2320588279499876916288464431571197661041376257288971393447245,
               1427300470481773281493004678460070117038346507736737829700363,
               2854600940963546562986009356920140234076693015473475659400726,
               2495325793409112574888094529157955263108980024105746361607325,
               1776775498300244598692264873633585321173554041370287766020523,
               339674908082508646300605562584845437302702075899370574846919,
               679349816165017292601211125169690874605404151798741149693838,
               1358699632330034585202422250339381749210808303597482299387676,
               2717399264660069170404844500678763498421616607194964598775352,
               2220922440802157789725764816675201791798827207548724240356577,
               1227968793086335028367605448668078378553248408256243523519027,
               2455937586172670056735210897336156757106496816512487047038054,
               1697999083827359562386497609989988309168587626183769136881981,
               182122079136738573689071035297651413292769245526333316569835,
               364244158273477147378142070595302826585538491052666633139670,
               728488316546954294756284141190605653171076982105333266279340,
               1456976633093908589512568282381211306342153964210666532558680,
               2913953266187817179025136564762422612684307928421333065117360,
               2614030443857653806966348944842520020324209850001461173040593,
               2014184799197327062848773705002714835604013693161717388887059,
               814493509876673574613623225323104466163621379482229820579991,
               1628987019753347149227246450646208932327242758964459641159982,
               44097950988713747370568716610092659610079511087714325125837,
               88195901977427494741137433220185319220159022175428650251674,
               176391803954854989482274866440370638440318044350857300503348,
               352783607909709978964549732880741276880636088701714601006696,
               705567215819419957929099465761482553761272177403429202013392,
               1411134431638839915858198931522965107522544354806858404026784,
               2822268863277679831716397863045930215045088709613716808053568,
               2430661638037379112348871541409535225045771412386228658913009,
               1647447187556777673613818898136745245047136817931252360631891,
               81018286595574796143713611591165285049867629021299764069655,
               162036573191149592287427223182330570099735258042599528139310,
               324073146382299184574854446364661140199470516085199056278620,
               648146292764598369149708892729322280398941032170398112557240,
               1296292585529196738299417785458644560797882064340796225114480,
               2592585171058393476598835570917289121595764128681592450228960,
               1971294253598806402113746957152253038147122250521979943263793,
               728712418679632253143569729622180871249838494202754929333459,
               1457424837359264506287139459244361742499676988405509858666918,
               2914849674718529012574278918488723484999353976811019717333836,
               2615823260919077474064633652295121764954301946780834477473545,
               2017770433320174397045343119907918324864197886720463997752963,
               821664778122368243006762055133511444683989766599723038311799,
               1643329556244736486013524110267022889367979533199446076623598,
               72783023971492420943124035851720573691553059557687196053069,
               145566047942984841886248071703441147383106119115374392106138,
               291132095885969683772496143406882294766212238230748784212276,
               582264191771939367544992286813764589532424476461497568424552,
               1164528383543878735089984573627529179064848952922995136849104,
               2329056767087757470179969147255058358129697905845990273698208,
               1444237445657534389276014109827791511214989804850775590202289,
               2888474891315068778552028219655583022429979609701551180404578,
               2563073694112157006020132254628840839815553212561897403615029,
               1912271299706333460956340324575356474586700418282589850035931,
               610666510894686370828756464468387744128994829723974742877735,
               1221333021789372741657512928936775488257989659447949485755470,
               2442666043578745483315025857873550976515979318895898971510940,
               1671455998639510415546127531064776747987552630950592985827753,
               129035908761040280008330877447228290930699255059981014461379,
               258071817522080560016661754894456581861398510119962028922758,
               516143635044161120033323509788913163722797020239924057845516,
               1032287270088322240066647019577826327445594040479848115691032,
               2064574540176644480133294039155652654891188080959696231382064,
               915272991835308409182663893628980104737970155078187505570001,
               1830545983670616818365327787257960209475940310156375011140002,
               447215878823253085646731389833595213907474613471545065085877,
               894431757646506171293462779667190427814949226943090130171754,
               1788863515293012342586925559334380855629898453886180260343508]

    # Cipher text
    cipher = [109028707944085756572684825349216418742828811107404683642761340,
              115389673988985363951879707259117283678569499310267678444211454,
              92040698092851208770256464770350777248362371755061857600294516]

    # Codification
    encoding = {' ':'00000', 'a':'00001', 'b':'00010', 'c':'00011', 'd':'00100',
                'e':'00101', 'f':'00110', 'g':'00111', 'h':'01000', 'i':'01001',
                'j':'01010', 'k':'01011', 'l':'01100', 'm':'01101', 'n':'01110',
                'Ã±':'01111', 'o':'10000', 'p':'10001', 'q':'10010', 'r':'10011',
                's':'10100', 't':'10101', 'u':'10110', 'v':'10111', 'w':'11000',
                'x':'11001', 'y':'11010', 'z':'11011', ',':'11100', '.':'11101',
                ';':'11110', ':':'11111'}

    text = 'esto es una prueba de un texto que queremos cifrar mediante el algoritmo de merkle hellman.'

    cipher = encrypt_text(text, pub_key, encoding)

    print(cipher)
    np.random.seed(1)

    alg = whale.WhaleOptimization(cipher, pub_key, 25)
    alg.attack()

